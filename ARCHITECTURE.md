# 🏗️ Movie Booking System - Architecture Diagram

## System Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                         CLIENT LAYER                             │
│  (Postman, cURL, Browser, Frontend Application)                 │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             │ HTTP Requests (JSON)
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│                    CONTROLLER LAYER                              │
│                    (@RestController)                             │
├─────────────────────────────────────────────────────────────────┤
│  MovieController          ShowController       BookingController │
│  ┌──────────────┐        ┌──────────────┐     ┌──────────────┐ │
│  │ POST /movies │        │ POST /shows  │     │ POST /bookings│ │
│  │ GET /movies  │        │ GET /shows   │     │ GET /bookings │ │
│  └──────────────┘        │ GET /shows/  │     │ DELETE /book..│ │
│                          │   movie/{id} │     └──────────────┘ │
│                          └──────────────┘                       │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             │ Method Calls
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│                     SERVICE LAYER                                │
│                     (@Service)                                   │
├─────────────────────────────────────────────────────────────────┤
│  MovieService            ShowService           BookingService    │
│  ┌──────────────┐       ┌──────────────┐      ┌──────────────┐ │
│  │ addMovie()   │       │ createShow() │      │ bookTickets()│ │
│  │ getAllMovies()│      │ getAllShows()│      │ getAllBook..()│ │
│  │ getMovieById()│      │ getShowsBy...│      │ cancelBook..()│ │
│  └──────────────┘       │ getShowById()│      └──────────────┘ │
│                         │ updateShow() │                        │
│                         └──────────────┘                        │
│                                                                  │
│  Business Logic:                                                │
│  • Validation                                                   │
│  • Seat Management (reduce/restore)                            │
│  • Auto-generate booking date                                  │
│  • Transaction Management (@Transactional)                     │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             │ JPA Methods
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│                   REPOSITORY LAYER                               │
│                   (JPA Repository)                               │
├─────────────────────────────────────────────────────────────────┤
│  MovieRepository         ShowRepository        BookingRepository │
│  ┌──────────────┐       ┌──────────────┐      ┌──────────────┐ │
│  │ save()       │       │ save()       │      │ save()       │ │
│  │ findAll()    │       │ findAll()    │      │ findAll()    │ │
│  │ findById()   │       │ findById()   │      │ findById()   │ │
│  │              │       │ findByMovie..│      │ deleteById() │ │
│  └──────────────┘       └──────────────┘      └──────────────┘ │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             │ SQL Queries (Auto-generated by JPA)
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│                     DATABASE LAYER                               │
│                     (MySQL)                                      │
├─────────────────────────────────────────────────────────────────┤
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────────────┐  │
│  │   MOVIES     │  │    SHOWS     │  │      BOOKINGS        │  │
│  ├──────────────┤  ├──────────────┤  ├──────────────────────┤  │
│  │ movie_id (PK)│  │ show_id (PK) │  │ booking_id (PK)      │  │
│  │ title        │  │ show_time    │  │ customer_name        │  │
│  │ genre        │  │ total_seats  │  │ seats_booked         │  │
│  │ duration     │  │ available_..│  │ booking_date         │  │
│  └──────────────┘  │ movie_id (FK)│  │ show_id (FK)         │  │
│                    └──────────────┘  └──────────────────────┘  │
│                           │                      │              │
│                           └──────────────────────┘              │
│                                Relationships:                   │
│                         Movie (1) ←→ (Many) Show                │
│                         Show (1) ←→ (Many) Booking              │
└─────────────────────────────────────────────────────────────────┘
```

## Data Flow Example: Booking Tickets

```
1. CLIENT sends POST request to /api/bookings
   ↓
   {
     "customerName": "Akash",
     "seatsBooked": 2,
     "show": {"showId": 1}
   }

2. BookingController receives request
   ↓
   @PostMapping
   public ResponseEntity<Booking> bookTickets(@RequestBody Booking booking)

3. BookingController calls BookingService
   ↓
   bookingService.bookTickets(booking)

4. BookingService executes business logic:
   ↓
   a. Get Show from ShowService
   b. Validate: seatsBooked <= availableSeats
   c. Reduce available seats: availableSeats -= seatsBooked
   d. Update Show in database
   e. Set booking date: LocalDate.now()
   f. Save Booking to database
   
   (@Transactional ensures all-or-nothing)

5. BookingRepository saves to database
   ↓
   INSERT INTO bookings (customer_name, seats_booked, booking_date, show_id)
   VALUES ('Akash', 2, '2026-01-17', 1)

6. Database returns saved entity
   ↓
   Booking with auto-generated ID

7. Response sent back to client
   ↓
   {
     "bookingId": 1,
     "customerName": "Akash",
     "seatsBooked": 2,
     "bookingDate": "2026-01-17",
     "show": {...}
   }
```

## Entity Relationships Diagram

```
┌─────────────────────┐
│       MOVIE         │
├─────────────────────┤
│ movieId (PK)        │
│ title               │
│ genre               │
│ duration            │
└──────────┬──────────┘
           │
           │ 1
           │
           │ has many
           │
           │ Many
           ▼
┌─────────────────────┐
│       SHOW          │
├─────────────────────┤
│ showId (PK)         │
│ showTime            │
│ totalSeats          │
│ availableSeats      │
│ movieId (FK)        │◄─── References Movie
└──────────┬──────────┘
           │
           │ 1
           │
           │ has many
           │
           │ Many
           ▼
┌─────────────────────┐
│      BOOKING        │
├─────────────────────┤
│ bookingId (PK)      │
│ customerName        │
│ seatsBooked         │
│ bookingDate         │
│ showId (FK)         │◄─── References Show
└─────────────────────┘
```

## Request/Response Flow

### Example 1: Add Movie

```
REQUEST:
POST http://localhost:8080/api/movies
Content-Type: application/json

{
  "title": "Inception",
  "genre": "Sci-Fi",
  "duration": 148
}

RESPONSE:
HTTP/1.1 201 Created
Content-Type: application/json

{
  "movieId": 1,
  "title": "Inception",
  "genre": "Sci-Fi",
  "duration": 148
}
```

### Example 2: Create Show

```
REQUEST:
POST http://localhost:8080/api/shows
Content-Type: application/json

{
  "showTime": "2026-02-10T18:30",
  "totalSeats": 100,
  "availableSeats": 100,
  "movie": {
    "movieId": 1
  }
}

RESPONSE:
HTTP/1.1 201 Created
Content-Type: application/json

{
  "showId": 1,
  "showTime": "2026-02-10T18:30",
  "totalSeats": 100,
  "availableSeats": 100,
  "movie": {
    "movieId": 1,
    "title": "Inception",
    "genre": "Sci-Fi",
    "duration": 148
  }
}
```

### Example 3: Book Tickets

```
REQUEST:
POST http://localhost:8080/api/bookings
Content-Type: application/json

{
  "customerName": "Akash",
  "seatsBooked": 2,
  "show": {
    "showId": 1
  }
}

PROCESSING:
1. Validate: 2 <= 100 ✓
2. Update Show: availableSeats = 100 - 2 = 98
3. Set bookingDate = 2026-01-17
4. Save booking

RESPONSE:
HTTP/1.1 201 Created
Content-Type: application/json

{
  "bookingId": 1,
  "customerName": "Akash",
  "seatsBooked": 2,
  "bookingDate": "2026-01-17",
  "show": {
    "showId": 1,
    "showTime": "2026-02-10T18:30",
    "availableSeats": 98,  ← Updated!
    ...
  }
}
```

## Component Dependencies

```
SimpleMovieApplication
    │
    ├── @ComponentScan discovers:
    │
    ├── Controllers
    │   ├── MovieController
    │   │   └── @Autowired MovieService
    │   ├── ShowController
    │   │   └── @Autowired ShowService
    │   └── BookingController
    │       └── @Autowired BookingService
    │
    ├── Services
    │   ├── MovieService
    │   │   └── @Autowired MovieRepository
    │   ├── ShowService
    │   │   ├── @Autowired ShowRepository
    │   │   └── @Autowired MovieService
    │   └── BookingService
    │       ├── @Autowired BookingRepository
    │       └── @Autowired ShowService
    │
    └── Repositories
        ├── MovieRepository (extends JpaRepository)
        ├── ShowRepository (extends JpaRepository)
        └── BookingRepository (extends JpaRepository)
```

## Technology Stack Integration

```
┌─────────────────────────────────────────────┐
│          Spring Boot Framework              │
│  ┌───────────────────────────────────────┐  │
│  │         Spring MVC (REST)             │  │
│  │  • @RestController                    │  │
│  │  • @RequestMapping                    │  │
│  │  • @GetMapping, @PostMapping, etc.   │  │
│  └───────────────────────────────────────┘  │
│  ┌───────────────────────────────────────┐  │
│  │       Spring Data JPA                 │  │
│  │  • JpaRepository                      │  │
│  │  • @Entity, @Table                    │  │
│  │  • @Transactional                     │  │
│  └───────────────────────────────────────┘  │
│  ┌───────────────────────────────────────┐  │
│  │    Jakarta Bean Validation            │  │
│  │  • @NotBlank, @Positive               │  │
│  │  • @Valid                             │  │
│  └───────────────────────────────────────┘  │
└─────────────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────┐
│            Hibernate (JPA Provider)         │
│  • ORM (Object-Relational Mapping)          │
│  • Auto DDL (create tables)                 │
│  • SQL Generation                           │
└─────────────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────┐
│         MySQL Connector/J (JDBC Driver)     │
└─────────────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────┐
│              MySQL Database                 │
│         (movie_booking_db)                  │
└─────────────────────────────────────────────┘
```

---

This architecture follows industry best practices:
✅ Separation of Concerns
✅ Dependency Injection
✅ Layered Architecture
✅ RESTful Design
✅ Transaction Management
✅ Data Validation
